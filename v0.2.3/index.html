<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · PositiveIntegrators.jl</title><meta name="title" content="Home · PositiveIntegrators.jl"/><meta property="og:title" content="Home · PositiveIntegrators.jl"/><meta property="twitter:title" content="Home · PositiveIntegrators.jl"/><meta name="description" content="Documentation for PositiveIntegrators.jl."/><meta property="og:description" content="Documentation for PositiveIntegrators.jl."/><meta property="twitter:description" content="Documentation for PositiveIntegrators.jl."/><meta property="og:url" content="https://SKopecz.github.io/PositiveIntegrators.jl/stable/"/><meta property="twitter:url" content="https://SKopecz.github.io/PositiveIntegrators.jl/stable/"/><link rel="canonical" href="https://SKopecz.github.io/PositiveIntegrators.jl/stable/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>PositiveIntegrators.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Basic-examples"><span>Basic examples</span></a></li><li><a class="tocitem" href="#Referencing"><span>Referencing</span></a></li><li><a class="tocitem" href="#License-and-contributing"><span>License and contributing</span></a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="npzd_model/">NPZD model</a></li><li><a class="tocitem" href="robertson/">Robertson problem</a></li><li><a class="tocitem" href="stratospheric_reaction/">Stratospheric reaction problem</a></li><li><a class="tocitem" href="linear_advection/">Linear Advection</a></li><li><a class="tocitem" href="heat_equation_neumann/">Heat Equation, Neumann BCs</a></li><li><a class="tocitem" href="heat_equation_dirichlet/">Heat Equation, Dirichlet BCs</a></li></ul></li><li><a class="tocitem" href="faq/">Troubleshooting, FAQ</a></li><li><a class="tocitem" href="api_reference/">API reference</a></li><li><a class="tocitem" href="contributing/">Contributing</a></li><li><a class="tocitem" href="code_of_conduct/">Code of conduct</a></li><li><a class="tocitem" href="license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SKopecz/PositiveIntegrators.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SKopecz/PositiveIntegrators.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="PositiveIntegrators.jl"><a class="docs-heading-anchor" href="#PositiveIntegrators.jl">PositiveIntegrators.jl</a><a id="PositiveIntegrators.jl-1"></a><a class="docs-heading-anchor-permalink" href="#PositiveIntegrators.jl" title="Permalink"></a></h1><p>The <a href="https://julialang.org">Julia</a> library <a href="https://github.com/SKopecz/PositiveIntegrators.jl">PositiveIntegrators.jl</a> provides several time integration methods developed to preserve the positivity of numerical solutions.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p><a href="https://github.com/SKopecz/PositiveIntegrators.jl">PositiveIntegrators.jl</a> is a registered Julia package. Thus, you can install it from the Julia REPL via</p><pre><code class="language-julia hljs">julia&gt; using Pkg; Pkg.add(&quot;PositiveIntegrators&quot;)</code></pre><p>If you want to update PositiveIntegrators.jl, you can use</p><pre><code class="language-julia hljs">julia&gt; using Pkg; Pkg.update(&quot;PositiveIntegrators&quot;)</code></pre><p>As usual, if you want to update PositiveIntegrators.jl and all other packages in your current project, you can execute</p><pre><code class="language-julia hljs">julia&gt; using Pkg; Pkg.update()</code></pre><h2 id="Basic-examples"><a class="docs-heading-anchor" href="#Basic-examples">Basic examples</a><a id="Basic-examples-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-examples" title="Permalink"></a></h2><h3 id="Modified-Patankar-Runge-Kutta-schemes"><a class="docs-heading-anchor" href="#Modified-Patankar-Runge-Kutta-schemes">Modified Patankar-Runge-Kutta schemes</a><a id="Modified-Patankar-Runge-Kutta-schemes-1"></a><a class="docs-heading-anchor-permalink" href="#Modified-Patankar-Runge-Kutta-schemes" title="Permalink"></a></h3><p>Modified Patankar-Runge-Kutta (MPRK) schemes are unconditionally positive and conservative time integration schemes for the solution of positive and conservative ODE systems. The application of these methods is based on the representation of the ODE system as a so-called production-destruction system (PDS).</p><h4 id="Production-destruction-systems-(PDS)"><a class="docs-heading-anchor" href="#Production-destruction-systems-(PDS)">Production-destruction systems (PDS)</a><a id="Production-destruction-systems-(PDS)-1"></a><a class="docs-heading-anchor-permalink" href="#Production-destruction-systems-(PDS)" title="Permalink"></a></h4><p>The application of MPRK schemes requires the ODE system to be represented as a production-destruction system (PDS). A PDS takes the general form</p><p class="math-container">\[    u_i&#39;(t) = \sum_{j=1}^N \bigl(p_{ij}(t,\boldsymbol u) - d_{ij}(t,\boldsymbol u)\bigr),\quad i=1,\dots,N,\]</p><p>where <span>$\boldsymbol u=(u_1,\dots,u_n)^T$</span> is the vector of unknowns and both production terms <span>$p_{ij}(t,\boldsymbol u)$</span> and destruction terms <span>$d_{ij}(t,\boldsymbol u)$</span> must be nonnegative for all <span>$i,j=1,\dots,N$</span>. The meaning behind <span>$p_{ij}$</span> and <span>$d_{ij}$</span> is as follows:</p><ul><li><span>$p_{ij}$</span> with <span>$i\ne j$</span> represents the sum of all nonnegative terms which appear in equation <span>$i$</span> with a positive sign and in equation <span>$j$</span> with a negative sign.</li><li><span>$d_{ij}$</span> with <span>$i\ne j$</span> represents the sum of all nonnegative terms which appear in equation <span>$i$</span> with a negative sign and in equation <span>$j$</span> with a positive sign.</li><li><span>$p_{ii}$</span> represents the sum of all nonnegative terms  which appear in equation <span>$i$</span> and don&#39;t have a negative counterpart in one of the other equations.</li><li><span>$d_{ii}$</span> represents the sum of all negative terms which appear in equation <span>$i$</span> and don&#39;t have a positive counterpart in one of the other equations.</li></ul><p>This naming convention leads to <span>$p_{ij} = d_{ji}$</span> for <span>$i≠ j$</span> and therefore a PDS is completely defined by the production matrix <span>$\mathbf{P}=(p_{ij})_{i,j=1,\dots,N}$</span> and the destruction vector <span>$\mathbf{d}=(d_{ii})_{i=1,\dots,N}$</span>.</p><p>As an example we consider the Lotka-Volterra model</p><p class="math-container">\[\begin{aligned}
u_1&#39; &amp;= 2u_1-u_1u_2,\\
u_2&#39; &amp;= u_1u_2-u_2,
\end{aligned}\]</p><p>which always has positive solutions if positive initial values are supplied. Assuming <span>$u_1,u_2&gt;0$</span>, the above naming scheme results in</p><p class="math-container">\[\begin{aligned}
p_{11}(u_1,u_2) &amp;= 2u_1,\\
p_{21}(u_1,u_2) &amp;= u_1u_2 = d_{12}(u_1,u_2) ,\\
d_{22}(u_1,u_2) &amp;= u_2,
\end{aligned}\]</p><p>where all remaining production and destruction terms are zero. Consequently the production matrix <span>$\mathbf P$</span> and destruction vector <span>$\mathbf d$</span> are</p><p class="math-container">\[\mathbf P(u_1,u_2) = \begin{pmatrix}2u_1 &amp; 0\\ u_1u_2 &amp; 0\end{pmatrix},\quad \mathbf d(u_1,u_2) = \begin{pmatrix}0\\ u_2\end{pmatrix}.\]</p><p>To solve this PDS together with initial values <span>$u_1(0)=u_2(0)=2$</span> on the time domain <span>$(0,10)$</span>, we first need to create a <code>PDSProblem</code>.</p><pre><code class="language-julia hljs">using PositiveIntegrators # load PDSProblem

P(u, p, t) = [2*u[1]  0; u[1]*u[2]  0] # Production matrix
d(u, p, t) = [0; u[2]] # Destruction vector

u0 = [2.0; 2.0] # initial values
tspan = (0.0, 10.0) # time span

# Create PDS
prob = PDSProblem(P, d, u0, tspan)</code></pre><p>Now that the problem has been created, we can solve it with any method of <a href="https://github.com/SKopecz/PositiveIntegrators.jl">PositiveIntegrators.jl</a>. In the following, we use the method <code>MPRK22(1.0)</code>. In addition, we could also use any method provided by <a href="https://docs.sciml.ai/OrdinaryDiffEq/stable/">OrdinaryDiffEq.jl</a>, but these might possibly generate negative approximations.</p><pre><code class="language-julia hljs">sol = solve(prob, MPRK22(1.0))</code></pre><p>Finally, we can use <a href="https://docs.juliaplots.org/stable/">Plots.jl</a> to visualize the solution.</p><pre><code class="language-julia hljs">using Plots

plot(sol)</code></pre><img src="index-9daf4282.svg" alt="Example block output"/><h4 id="Conservative-production-destruction-systems"><a class="docs-heading-anchor" href="#Conservative-production-destruction-systems">Conservative production-destruction systems</a><a id="Conservative-production-destruction-systems-1"></a><a class="docs-heading-anchor-permalink" href="#Conservative-production-destruction-systems" title="Permalink"></a></h4><p>A PDS with the additional property</p><p class="math-container">\[  p_{ii}(t,\boldsymbol y)=d_{ii}(t,\boldsymbol y)=0\]</p><p>for <span>$i=1,\dots,N$</span> is called conservative. In this case we have <span>$p_{ij}=d_{ji}$</span> for all <span>$i,j=1,\dots,N$</span>, which leads to</p><p class="math-container">\[\frac{d}{dt}\sum_{i=1}^N y_i=\sum_{i=1}^N y_i&#39; = \sum_{\mathclap{i,j=1}}^N \bigl(p_{ij}(t,\boldsymbol y) - d_{ij}(t,\boldsymbol y)\bigr)= \sum_{\mathclap{i,j=1}}^N \bigl(p_{ij}(t,\boldsymbol y) - p_{ji}(t,\boldsymbol y)\bigr) = 0.\]</p><p>This shows that the sum of the state variables of a conservative PDS remains constant over time, i.e.</p><p class="math-container">\[\sum_{i=1}^N y_i(t) = \sum_{i=1}^N y_i(0)\]</p><p>for all times <span>$t&gt;0$</span>.</p><p>One specific example of a conservative PDS is the SIR model</p><p class="math-container">\[S&#39; = -\frac{β S I}{N},\quad I&#39;= \frac{β S I}{N} - γ I,\quad R&#39;=γ I,\]</p><p>with <span>$N=S+I+R$</span> and <span>$\beta,\gamma&gt;0$</span>. Assuming <span>$S,I,R&gt;0$</span> the production and destruction terms are given by</p><p class="math-container">\[p_{21}(S,I,R) = d_{12}(S,I,R) = \frac{β S I}{N},\quad p_{32}(S,I,R) = d_{23}(S,I,R) = γ I,\]</p><p>where the remaining production and destruction terms are zero. The corresponding production matrix <span>$\mathbf P$</span> is</p><p class="math-container">\[\mathbf P(S,I,R) = \begin{pmatrix}0 &amp; 0 &amp; 0\\ \frac{β S I}{N} &amp; 0 &amp; 0\\ 0 &amp; γ I &amp; 0\end{pmatrix}.\]</p><p>The following example shows how to implement the above SIR model with <span>$\beta=0.4, \gamma=0.04$</span>, initial conditions <span>$S(0)=997, I(0)=3, R(0)=0$</span> and time domain <span>$(0, 100)$</span> using <code>ConservativePDSProblem</code> from <a href="https://github.com/SKopecz/PositiveIntegrators.jl">PositiveIntegrators.jl</a>.</p><pre><code class="language-julia hljs">using PositiveIntegrators

# Out-of-place implementation of the P matrix for the SIR model
function P(u, p, t)
  S, I, R = u

  β = 0.4
  γ = 0.04
  N = 1000.0

  P = zeros(3,3)
  P[2,1] = β*S*I/N
  P[3,2] = γ*I
  return P
end

u0 = [997.0; 3.0; 0.0]; # initial values
tspan = (0.0, 100.0); # time span

# Create SIR problem
prob = ConservativePDSProblem(P, u0, tspan)</code></pre><p>Since the SIR model is not only conservative but also positive, we can use any scheme from <a href="https://github.com/SKopecz/PositiveIntegrators.jl">PositiveIntegrators.jl</a> to solve it. Here we use <code>MPRK22(1.0)</code>. Please note that any method from <a href="https://docs.sciml.ai/OrdinaryDiffEq/stable/">OrdinaryDiffEq.jl</a> can be used as well, but might possibly generate negative approximations.</p><pre><code class="language-julia hljs">sol = solve(prob, MPRK22(1.0))</code></pre><p>Finally, we can use <a href="https://docs.juliaplots.org/stable/">Plots.jl</a> to visualize the solution.</p><pre><code class="language-julia hljs">using Plots

plot(sol, label = [&quot;S&quot; &quot;I&quot; &quot;R&quot;], legend=:right)
plot!(sol.t, sum.(sol.u), label = &quot;S+I+R&quot;) # Plot S+I+R over time.</code></pre><img src="index-130dd1a1.svg" alt="Example block output"/><p>We see that there is always a nonnegative number of people in each compartment, while the population <span>$S+I+R$</span> remains constant over time.</p><h2 id="Referencing"><a class="docs-heading-anchor" href="#Referencing">Referencing</a><a id="Referencing-1"></a><a class="docs-heading-anchor-permalink" href="#Referencing" title="Permalink"></a></h2><p>If you use <a href="https://github.com/ranocha/PositiveIntegrators.jl">PositiveIntegrators.jl</a> for your research, please cite it using the bibtex entry</p><pre><code class="language-bibtex hljs">@misc{PositiveIntegrators.jl,
  title={{PositiveIntegrators.jl}: {A} {J}ulia library of positivity-preserving
         time integration methods},
  author={Kopecz, Stefan and Ranocha, Hendrik and contributors},
  year={2023},
  doi={10.5281/zenodo.10868393},
  url={https://github.com/SKopecz/PositiveIntegrators.jl}
}</code></pre><h2 id="License-and-contributing"><a class="docs-heading-anchor" href="#License-and-contributing">License and contributing</a><a id="License-and-contributing-1"></a><a class="docs-heading-anchor-permalink" href="#License-and-contributing" title="Permalink"></a></h2><p>This project is licensed under the MIT license (see <a href="license/#License">License</a>). Since it is an open-source project, we are very happy to accept contributions from the community. Please refer to the section <a href="contributing/#Contributing">Contributing</a> for more details.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="npzd_model/">NPZD model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Monday 19 August 2024 15:44">Monday 19 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
